### 为什么需要搜索引擎？

> 数据量太大时，从数据库搜索满足不了业务需求。比如淘宝上搜索商品、百度上搜资料等。



对搜索内容分词，中文总共约27w分词。



lucene 单实例的全文搜索引擎，不支持集群

elasticSearch 基于Lucene的分布式全文搜索引擎



## [ElasticSearch](https://www.elastic.co/cn/elasticsearch/)

### 功能

**分布式的搜索引擎和数据分析引擎**

> 1. 搜索：互联网搜索、电商网站站内搜索
> 2. 数据分析：电商网站最近热门商品、舆情分析

**全文检索、结构化检索、数据分析**

**对海量数据进行近实时的处理**

> 近实时：数据库上亿条数据查询，搜索一次耗时几个小时， 是批处理(batch-processing)。而es只需秒级即可查询海量数据，所以叫近实时（秒级）。



### 特点

> 1. 可拓展性：大型分布式集群(数百台服务器)技术，处理PB级数据，大公司可以使用。小公司数据量小，也可以部署在单机。大数据领域使用广泛。
> 2. 技术整合：将全文检索、数据分析、分布式相关技术整合在一起lucene (全文检索)，商用的数据分析软件(BI软件)，分布式数据库(mycat)。
> 3. 部署简单：开箱即用，很多默认配置不需关心，解压完成直接运行即可。拓展时，只需多部署几个实例即可，负载均衡、分片迁移集群内部自己实施。
> 4. 接口简单：使用restful api进行交互， 跨语言。
> 5. 功能强大：Elasticsearch作为传统数据库的一个补充，提供了数据库所不不能提供的很多功能，如全文检索，同义词处理，相关度排名。



### 核心概念

1. NRT(Near Realtime) 近实时：写数据时过1秒才会被搜索到（内部分词、索引录入），读秒级（搜索和分析数据秒出结果）

2. 集群Cluster：同一网络下集群名一样的ES自动组成集群

3. Node：节点，每个es实例称为一个节点，节点名自动分配也可手动分配

4. index：索引，存储有相似结构的文档数据

   > 索引创建规则：仅限小写字母，不能包含\ / * ? " < > | # 空格等特殊符号；不能以- _ + 开头；不能超过255个字节；7.0版本开始不再包含冒号

5. Document：文档，es中最小的数据单元，相当于一条数据库数据（通常以json格式显示），多个文档存储于一个索引（index）中

6. field：字段，相当于数据表的列，定义文档中的字段

7. type：（7.7之后被去除了）

8. shard：分片

   > index数据过大时，将index里面的数据，分为多个shard，分布式的存储在各个服务器上面。可以支持海量数据和高并发,提升性能和吞吐量，充分利用多台机器的cpu。

9. replica：副本

   > 如果宕机，index的一 个分片没有，会导致此index不能搜索。所以,为了保证数据的安全，我们会将每个index的分片进行备份。能正常提供查询和插入的分片我们叫做主分片(primary shard)，其余的我们就管他们叫做备份的分片(replica shard)。

### es与mysql核心概念对比

| 关系性数据库（如mysql） | 非关系数据库(es)    |
| ----------------------- | ------------------- |
| 数据库Database          | 索引Index           |
| 表Table                 | 索引ndex (原为Type) |
| 数据行Row               | 文档Document        |
| 数据列Column            | 字段Field           |
| 约束Schema              | 映射Mapping         |



### 核心原理





树形结构，插入和删除不用移动全部数据，兼顾增删查的效率（）

Term：分类索引；Posting List：倒排索引

会为每个字段建立一个倒排表。



不需要索引的字段，要定义处理，不然默认会处理成索引。另外String类型同理需要定义出来。